# 実践ワークフロー

AI エージェントと OrcaSlicer MCP Server を組み合わせた、
具体的な使い方のシナリオを紹介します。

---

## 目次

1. [基本の流れ: 探索 → 調整 → スライス → 評価](#シナリオ-1-はじめてのスライス)
2. [印刷品質を試行錯誤で最適化する](#シナリオ-2-印刷品質の最適化)
3. [複数のフィラメントを比較する](#シナリオ-3-フィラメント比較)
4. [設定項目を探索して理解する](#シナリオ-4-設定項目の探索)

---

## シナリオ 1: はじめてのスライス

**目的**: 手元の STL ファイルをスライスして、印刷時間を確認したい。

### ステップ 1 — 環境確認

AI に話しかける:

> 「環境を確認して」

AI は `health_check` を実行し、OrcaSlicer とフォルダの状態を報告します。

### ステップ 2 — 使えるプロファイルを確認

> 「使えるプリンターの一覧を見せて」

AI は `list_profiles` を実行します:

```json
{
  "type": "machine",
  "profiles": ["Bambu Lab X1 Carbon 0.4 nozzle.json", "Prusa MK4.json"]
}
```

> 「フィラメント設定は何がある？」

> 「プロセス設定（印刷品質）の一覧も見せて」

### ステップ 3 — スライスを実行

作業フォルダに `benchy.stl` を置いた状態で:

> 「benchy.stl を Bambu Lab X1 の設定でスライスして。
> フィラメントは PLA Generic、印刷品質は 0.2mm の標準設定で」

AI は `slice_model` を実行します。

### ステップ 4 — 結果を確認

> 「スライス結果の印刷時間とフィラメント使用量を教えて」

AI は `analyze_gcode_metadata` を実行し、構造化された結果を返します:

```
- 推定印刷時間: 1h 23m
- フィラメント使用量: 3.8m (11.4g)
- フィラメントコスト: ¥38
- 総レイヤー数: 150
```

---

## シナリオ 2: 印刷品質の最適化

**目的**: インフィル密度を変えて、印刷時間と強度のバランスを探りたい。

### ステップ 1 — 現在の設定を確認

> 「現在のプロセス設定でインフィルに関する項目を全部見せて」

AI は `search_settings` で `"infill"` を検索します:

```
- infill_density: 20 (%)
- infill_pattern: grid
- infill_speed: 80 (mm/s)
```

### ステップ 2 — 設定を変更してスライス

> 「インフィル密度を 40% に変更して、その設定でスライスして」

AI は以下の手順を実行します:

1. `update_profile_setting` でインフィル密度を 40% に変更
   - `standard_quality_tuned.json` として保存される（元ファイルは無傷）
2. `slice_model` で変更後の設定を使ってスライス
3. `analyze_gcode_metadata` で結果を分析

### ステップ 3 — 比較結果を見る

> 「元の 20% と 40% で、印刷時間とフィラメント使用量を比較して」

AI が両方の結果をまとめてくれます:

```
インフィル密度の比較:
                    20%         40%
印刷時間:          1h 23m      1h 45m (+22分)
フィラメント:      11.4g       15.2g (+3.8g)
```

### ステップ 4 — さらに追い込む

> 「インフィルパターンを gyroid に変えたらどうなる？」

> 「印刷速度を 100mm/s に上げて時間を短縮できない？」

このように、AI と対話しながら設定を少しずつ調整していけます。

---

## シナリオ 3: フィラメント比較

**目的**: PLA と PETG で同じモデルをスライスして、結果を比較したい。

### 手順

> 「PLA と PETG のフィラメントプロファイルを見せて」

> 「同じ benchy.stl を PLA と PETG でそれぞれスライスして。
> 出力ファイル名は benchy_pla.gcode と benchy_petg.gcode にして」

> 「両方の結果を比較して。印刷時間とフィラメント使用量の違いを教えて」

AI は順番にスライスと分析を行い、比較結果を表形式で示します。

---

## シナリオ 4: 設定項目の探索

**目的**: OrcaSlicer にはどんな設定項目があるのか、AI の力を借りて理解したい。

### 速度関連の設定を探す

> 「速度に関する設定を全部探して」

AI は `search_settings` で `"speed"` を検索し、
すべてのプロファイルから速度関連の設定を抽出します:

```
プロセス設定 (standard_quality.json):
  - print_speed: 60
  - travel_speed: 120
  - infill_speed: 80
  - wall_speed: 40
  - support_speed: 50
  - ...
```

### 設定項目の意味を聞く

> 「wall_speed と print_speed の違いは何？」

AI は 3D プリンティングの知識を使って説明してくれます。

### 温度設定を探す

> 「温度関連の設定をフィラメントプロファイルから探して」

```
フィラメント設定 (PLA Generic.json):
  - temperature_nozzle: 210
  - temperature_bed: 60
  - temperature_nozzle_first_layer: 215
```

---

## 対話のコツ

### 曖昧な指示でも大丈夫

AI は `search_settings` を使って適切な設定キーを見つけてくれるので、
正確なキー名を知らなくても大丈夫です。

- 「インフィルを増やして」→ AI が `infill_density` を特定して変更
- 「もっと速く印刷したい」→ AI が速度関連の設定を探して提案
- 「ベッドの温度を上げて」→ AI が `temperature_bed` を特定

### 元に戻したいとき

設定変更はデフォルトで `_tuned` コピーに保存されるので、
元の設定はいつでも使えます。

> 「元の設定に戻してスライスし直して」

AI は元のプロファイル（`_tuned` がついていないもの）を使ってスライスします。

### 変更履歴を確認したいとき

> 「今日の変更履歴を見せて」

作業フォルダ内の `tuning_history.log` が参照されます。

---

## 応用: AI による自律的なチューニングサイクル

このサーバーは、AI が以下のサイクルを自律的に回せるように設計されています:

```
1. 探索 (search_settings)
   ↓ どんな設定があるか理解する
2. 調整 (update_profile_setting)
   ↓ パラメータを変更する
3. 実行 (slice_model)
   ↓ スライスして G-code を生成する
4. 評価 (analyze_gcode_metadata)
   ↓ 結果を数値で確認する
5. 判断
   ↓ 目標に近づいたか？→ 2 に戻って再調整
```

例:

> 「印刷時間を 1 時間以内に収めたい。
> 品質をなるべく保ちながら、速度やインフィルを自動調整してみて」

AI はこのサイクルを繰り返し、目標に近づく設定を探索してくれます。
